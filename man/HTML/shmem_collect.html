<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>shmem_collect</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body><h1><a href="../main.html">Index</a></h1>
<h1 id="summary">Summary</h1>
<pre><code>Concatenates blocks of data from multiple PEs to an array in every PE.</code></pre>
<h1 id="definitions">Definitions</h1>
<h2 id="cc-synopsis">C/C++ Synopsis</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">void</span> shmem_collect32(void *dest, const void *source, size_t nelems,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                     <span class="ex">int</span> PE_start, int logPE_stride, int PE_size,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                     <span class="ex">long</span> *pSync);</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="ex">void</span> shmem_collect64(void *dest, const void *source, size_t nelems,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                     <span class="ex">int</span> PE_start, int logPE_stride, int PE_size,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">                     <span class="ex">long</span> *pSync);</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="ex">void</span> shmem_fcollect32(void *dest, const void *source, size_t nelems,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">                     <span class="ex">int</span> PE_start, int logPE_stride, int PE_size,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">                     <span class="ex">long</span> *pSync);</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="ex">void</span> shmem_fcollect64(void *dest, const void *source, size_t nelems,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">                     <span class="ex">int</span> PE_start, int logPE_stride, int PE_size,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">                     <span class="ex">long</span> *pSync);</a></code></pre></div>
<h1 id="deprecated-synopsis">Deprecated Synopsis</h1>
<h1 id="deprecated-fortran-synopsis">Deprecated Fortran Synopsis</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ex">INTEGER</span> nelems</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="ex">INTEGER</span> PE_start, logPE_stride, PE_size</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="ex">INTEGER</span> pSync(SHMEM_COLLECT_SYNC_SIZE)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="ex">CALL</span> SHMEM_COLLECT4(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="ex">CALL</span> SHMEM_COLLECT8(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="ex">CALL</span> SHMEM_COLLECT32(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="ex">CALL</span> SHMEM_COLLECT64(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="ex">CALL</span> SHMEM_FCOLLECT4(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="ex">CALL</span> SHMEM_FCOLLECT8(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="ex">CALL</span> SHMEM_FCOLLECT32(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="ex">CALL</span> SHMEM_FCOLLECT64(dest, source, nelems, PE_start, logPE_stride, PE_size, pSync)</a></code></pre></div>
<h1 id="arguments">Arguments</h1>
<pre><code>dest        A symmetric data object. The dest array argument must be large
            enough to accept the concatenation of the source arrays on all
            participating PEs.  The data types are as follows:
            For shmem_collect8, shmem_collect64, shmem_fcollect8, and
            shmem_fcollect64, any data type with an element size of 64 bits.
            Fortran derived types, Fortran character type, and  C/C++
            structures  are not permitted.  For shmem_collect4,
            shmem_collect32, shmem_fcollect4, and shmem_fcollect32,
            any data type with an element size of 32 bits.  Fortran
            derived types, Fortran character type, and  C/C++ structures are
            not permitted.
source      A symmetric data object that can be of any type permissible
            for the dest argument.
nelems      The number of elements in the source array. nelems
            must be of type size_t for C. When using Fortran, it must be
            a default integer value.
PE_start    The lowest PE number of the active set of PEs.  PE_start must be
            of type integer.  When using Fortran, it must be a default integer
            value.
logPE_stride    The log (base 2) of the stride between consecutive PE numbers
            in the active set. log_PE_stride must be of type integer.  When
            using Fortran, it must be a default integer value.
PE_size     The number of PEs in the active set. PE_size must be of type
            integer.  When using Fortran, it must be a default integer value.
pSync       A symmetric work array of size SHMEM_COLLECT_SYNC_SIZE.
            In  C/C++, pSync must be an array of elements of type `long`.
            In Fortran, pSync must be an array of elements of default integer type.
            Every element of this array must be initialized with the value
            SHMEM_SYNC_VALUE before any of the PEs in the active set
            enters shmem_broadcast.</code></pre>
<h1 id="description">Description</h1>
<pre><code>OpenSHMEM collect and fcollect routines concatenate nelems 64-bit or 32-bit
data items from the source array into the dest array, over the set of PEs
defined by PE_start, log2PE_stride, and PE_size, in processor number order.
The resultant dest array contains the contribution from PE PE_start
first, then the contribution from PE PE_start + PE_stride second, and so on.
The collected result is written to the dest array for all PEs in the active
set.

The fcollect routines require that nelems be the same value in all
participating PEs, while the collect routines allow nelems to vary from PE to PE.

As with all OpenSHMEM collective routines, each of these routines assumes that
only PEs in the active set call the routine. If a PE not in the
active set and calls this collective routine, the behavior is undefined.

The values of arguments PE_start, logPE_stride, and PE_size
must be the same value on all PEs in the active set. The same dest and source
arrays and the same pSync work array must be passed by all PEs in the
active set.

Upon return from a collective routine, the following are true for the local
PE: The dest array is updated and the source array may be safely reused.
The values in the pSync array are restored to the original values.</code></pre>
<h1 id="return-values">Return Values</h1>
<pre><code>None.</code></pre>
<h1 id="notes">Notes</h1>
<pre><code>All OpenSHMEM collective routines reset the values in pSync before they
return, so a particular pSync buffer need only be initialized the first
time it is used.

The user must ensure that the pSync array is not being updated on any PE
in the active set while any of the PEs participate in processing of an
OpenSHMEM collective routine.  Be careful to avoid these situations: If the
pSync array is initialized at run time, some type of synchronization is
needed to ensure that all PEs in the working set have initialized
pSync before any of them  enter an OpenSHMEM routine called with the
pSync synchronization array.  A pSync array can be reused on a
subsequent OpenSHMEM collective routine only if none of the PEs in the
active set  are still processing a  prior OpenSHMEM collective routine call
that used the same pSync array.  In general, this may be ensured only by
doing some type of synchronization.

The collective routines operate on active PE sets that have a
non-power-of-two PE_size with some performance degradation.  They operate
with no performance degradation when nelems is a non-power-of-two value.</code></pre>
<h1 id="examples">Examples</h1>
<h2 id="cc-example">C/C++ Example</h2>
<pre><code>The following shmem_collect example is for  C/C++ programs:</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#include &lt;stdio.h&gt;</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#include &lt;stdlib.h&gt;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#include &lt;shmem.h&gt;</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="ex">int</span> main(void)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw">{</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">   <span class="ex">static</span> long lock = 0<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">   <span class="ex">static</span> long pSync[SHMEM_COLLECT_SYNC_SIZE]<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">   <span class="kw">for</span> <span class="kw">(</span><span class="ex">int</span> i = 0<span class="kw">;</span> <span class="ex">i</span> <span class="op">&lt;</span> SHMEM_COLLECT_SYNC_SIZE<span class="kw">;</span> <span class="ex">i++</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">      <span class="ex">pSync</span>[i] = SHMEM_SYNC_VALUE<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">   <span class="fu">shmem_init()</span>;</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">   <span class="ex">int</span> me = shmem_my_pe();</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">   <span class="ex">int</span> npes = shmem_n_pes();</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">   <span class="ex">int</span> my_nelem = me + 1<span class="kw">;</span> <span class="ex">/*</span> linearly increasing number of elements with PE */</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">   <span class="ex">int</span> total_nelem = (npes * (npes + 1)) <span class="ex">/</span> 2<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"></a>
<a class="sourceLine" id="cb9-18" data-line-number="18">   <span class="ex">int*</span> source = (int*) <span class="ex">shmem_malloc</span>(npes*sizeof(int)); <span class="ex">/*</span> symmetric alloc */</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">   <span class="ex">int*</span> dest = (int*) <span class="ex">shmem_malloc</span>(total_nelem*sizeof(int));</a>
<a class="sourceLine" id="cb9-20" data-line-number="20"></a>
<a class="sourceLine" id="cb9-21" data-line-number="21">   <span class="kw">for</span> <span class="kw">(</span><span class="ex">int</span> i = 0<span class="kw">;</span> <span class="ex">i</span> <span class="op">&lt;</span> my_nelem<span class="kw">;</span> <span class="ex">i++</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">      <span class="ex">source</span>[i] = (me * (me + 1)) <span class="ex">/</span> 2 + i<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23">   <span class="kw">for</span> <span class="kw">(</span><span class="ex">int</span> i = 0<span class="kw">;</span> <span class="ex">i</span> <span class="op">&lt;</span> total_nelem<span class="kw">;</span> <span class="ex">i++</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">      <span class="ex">dest</span>[i] = -9999<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"></a>
<a class="sourceLine" id="cb9-26" data-line-number="26">   <span class="fu">shmem_barrier_all()</span>; <span class="ex">/*</span> Wait for all PEs to update source/dest */</a>
<a class="sourceLine" id="cb9-27" data-line-number="27"></a>
<a class="sourceLine" id="cb9-28" data-line-number="28">   <span class="ex">shmem_collect32</span>(dest, source, my_nelem, 0, 0, npes, pSync);</a>
<a class="sourceLine" id="cb9-29" data-line-number="29"></a>
<a class="sourceLine" id="cb9-30" data-line-number="30">   <span class="ex">shmem_set_lock</span>(<span class="kw">&amp;</span><span class="ex">lock</span>); <span class="ex">/*</span> Lock prevents interleaving printfs */</a>
<a class="sourceLine" id="cb9-31" data-line-number="31">   <span class="bu">printf</span>(<span class="st">&quot;%d: %d&quot;</span>, me, dest[0]);</a>
<a class="sourceLine" id="cb9-32" data-line-number="32">   <span class="kw">for</span> <span class="kw">(</span><span class="ex">int</span> i = 1<span class="kw">;</span> <span class="ex">i</span> <span class="op">&lt;</span> total_nelem<span class="kw">;</span> <span class="ex">i++</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33">      <span class="bu">printf</span>(<span class="st">&quot;, %d&quot;</span>, dest[i]);</a>
<a class="sourceLine" id="cb9-34" data-line-number="34">   <span class="bu">printf</span>(<span class="st">&quot;\n&quot;</span>);</a>
<a class="sourceLine" id="cb9-35" data-line-number="35">   <span class="ex">shmem_clear_lock</span>(<span class="kw">&amp;</span><span class="ex">lock</span>);</a>
<a class="sourceLine" id="cb9-36" data-line-number="36">   <span class="fu">shmem_finalize()</span>;</a>
<a class="sourceLine" id="cb9-37" data-line-number="37">   <span class="bu">return</span> 0<span class="kw">;</span></a>
<a class="sourceLine" id="cb9-38" data-line-number="38"><span class="kw">}</span></a></code></pre></div>
<h2 id="fortran-example">Fortran Example</h2>
<pre><code>The following SHMEM_COLLECT example is for Fortran programs:</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ex">INCLUDE</span> <span class="st">&quot;shmem.fh&quot;</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="ex">INTEGER</span> PSYNC(SHMEM_COLLECT_SYNC_SIZE)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="ex">DATA</span> PSYNC /SHMEM_COLLECT_SYNC_SIZE*SHMEM_SYNC_VALUE/</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="ex">CALL</span> SHMEM_COLLECT4(DEST, SOURCE, 64, PE_START, LOGPE_STRIDE,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="kw">&amp;</span>  <span class="ex">PE_SIZE</span>, PSYNC)</a></code></pre></div>
<h1><a href="../main.html">Index</a></h1></body>
</html>
